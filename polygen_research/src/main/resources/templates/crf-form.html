<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Nuevo Formulario CRF</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        
        .menu { background-color: #333; padding: 15px 30px; }
        .menu a { color: white; margin-right: 20px; text-decoration: none; font-weight: bold; }
        .menu a:hover { text-decoration: underline; }
        
    </style>
</head>
<body>

    <nav class="menu">
        <a th:href="@{/}">Inicio</a>
        <a th:href="@{/pacientes/list}">Pacientes</a>
        <!--<a th:href="@{/crfs/list}">CRFs</a>-->
        <a th:href="@{/usuarios/list}">Usuarios</a>
        <a th:href="@{/campos/list}">Campos</a>
        <a th:href="@{/registros/list}">Logs</a>
    </nav>

    <div class="container mt-5">
        
        <form th:action="@{/crf/guardar}" th:object="${crfForm}" method="post">
            
            <div class="card mb-4">
                <div class="card-header bg-primary text-white">
                    <h3>1. Datos del Paciente</h3>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="codigoPaciente" class="form-label">Código</label>
                            <input type="text" class="form-control" id="codigoPaciente" th:field="*{datosPaciente.codigoPaciente}" required>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="nombre" class="form-label">Nombre</label>
                            <input type="text" class="form-control" id="nombre" th:field="*{datosPaciente.nombre}" required>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="apellido" class="form-label">Apellido</label>
                            <input type="text" class="form-control" id="apellido" th:field="*{datosPaciente.apellido}" required>
                        </div>
                    </div>
                    <div class="mb-3">
                        <label for="numero" class="form-label">Número Contacto</label>
                        <input type="text" class="form-control" id="numero" th:field="*{datosPaciente.numero}">
                    </div>
                    <div class="mb-3">
                        <label for="direccion" class="form-label">Dirección</label>
                        <input type="text" class="form-control" id="direccion" th:field="*{datosPaciente.direccion}">
                    </div>
                    <div class="mb-3">
                        <label for="estado" class="form-label">Estado</label>
                        <input type="text" class="form-control" id="estado" th:field="*{datosPaciente.estado}">
                    </div>
                </div>
            </div>

            <div class="card">
                <div class="card-header bg-success text-white">
                    <h3>2. Datos del Estudio (CRF)</h3>
                </div>
                <div class="card-body">
                    <div th:each="dato, stat : *{datosCrfList}" class="mb-3">
                        
                        <label th:for="${'valor-' + stat.index}" 
                               th:text="${dato.campoCrf.nombre}" 
                               class="form-label fw-bold"></label>

                        <div th:switch="${dato.campoCrf.tipo}">
                            
                            <input th:case="'NUMERO'" 
                                   type="number" 
                                   class="form-control" 
                                   th:id="${'valor-' + stat.index}"
                                   th:field="*{datosCrfList[__${stat.index}__].valor}">
                                   
                            <input th:case="'FECHA'" 
                                   type="date" 
                                   class="form-control" 
                                   th:id="${'valor-' + stat.index}"
                                   th:field="*{datosCrfList[__${stat.index}__].valor}">

                            <input th:case="*" 
                                   type="text" 
                                   class="form-control" 
                                   th:id="${'valor-' + stat.index}"
                                   th:field="*{datosCrfList[__${stat.index}__].valor}">
                        </div>

                        <input type="hidden" th:field="*{datosCrfList[__${stat.index}__].campoCrf.idCampo}" />
                    </div>
                </div>
            </div>

            <hr class="my-4">
            
            <button type="submit" class="btn btn-primary btn-lg">Guardar CRF Completo</button>
            <a th:href="@{/pacientes/list}" class="btn btn-secondary btn-lg">Cancelar</a>

        </form>
        
        <div th:if="${errorMessage}" class="alert alert-danger mt-4" role="alert">
            <strong>Error:</strong> <span th:text="${errorMessage}"></span>
        </div>

    </div>

</body>
</html>
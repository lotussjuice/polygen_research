<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" th:replace="~{layout/main-layout :: ~{}}">

<div th:fragment="contenido">
    
    <form th:action="@{/crf/guardar}" th:object="${crfForm}" method="post">
        
        <div class="card">
            <div class="card-header">
                <h3><i class="ph-bold ph-user-plus"></i> 1. Datos del Paciente</h3>
            </div>
            <div class="card-body"> 
                
                <div class="grid-2">
                    <div class="form-group">
                        <label for="codigoPaciente">Código</label>
                        <input type="text" class="form-control" id="codigoPaciente" th:field="*{datosPaciente.codigoPaciente}" required>
                    </div>
                </div>

                <div class="grid-2">
                    <div class="form-group">
                        <label for="nombre">Nombre</label>
                        <input type="text" class="form-control" id="nombre" th:field="*{datosPaciente.nombre}" required>
                    </div>
                    <div class="form-group">
                        <label for="apellido">Apellido</label>
                        <input type="text" class="form-control" id="apellido" th:field="*{datosPaciente.apellido}" required>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="numero">Número Contacto</label>
                    <input type="text" class="form-control" id="numero" th:field="*{datosPaciente.numero}">
                </div>
                <div class="form-group">
                    <label for="direccion">Dirección</label>
                    <input type="text" class="form-control" id="direccion" th:field="*{datosPaciente.direccion}">
                </div>
                <div class="form-group">
                    <label for="estado">Estado</label>
                    <input type="text" class="form-control" id="estado" th:field="*{datosPaciente.estado}">
                </div>
            </div>
        </div>

        <div class="card" style="margin-top: 1.5rem;">
            <div class="card-header">
                <h3><i class="ph-bold ph-clipboard-text"></i> 2. Datos del Estudio (CRF)</h3>
            </div>
            <div class="card-body">
                
                <div th:each="dato, stat : *{datosCrfList}" class="form-group">
                    
                    <label th:for="${'valor-' + stat.index}" 
                           th:text="${dato.campoCrf.nombre}"></label>

                    <div th:switch="${dato.campoCrf.tipo}">
                        
                        <input th:case="'NUMERO'" 
                               type="number" 
                               class="form-control" 
                               th:id="${'valor-' + stat.index}"
                               th:field="*{datosCrfList[__${stat.index}__].valor}">
                               
                        <input th:case="'FECHA'" 
                               type="date" 
                               class="form-control" 
                               th:id="${'valor-' + stat.index}"
                               th:field="*{datosCrfList[__${stat.index}__].valor}">

                        <input th:case="*" 
                               type="text" 
                               class="form-control" 
                               th:id="${'valor-' + stat.index}"
                               th:field="*{datosCrfList[__${stat.index}__].valor}">
                    </div>

                    <input type="hidden" th:field="*{datosCrfList[__${stat.index}__].campoCrf.idCampo}" />
                </div>
            </div>
        </div>

        <div style="margin-top: 1.5rem; display: flex; gap: 1rem;">
            <button type="submit" class="btn-primario">Guardar CRF Completo</button>
            
            <a th:href="@{/inicio}" class="btn-secundario">Cancelar</a>
        </div>
        
        <div th:if="${errorMessage}" class="alert alert-error" style="margin-top: 1.5rem;">
            <strong>Error:</strong> <span th:text="${errorMessage}"></span>
        </div>

    </form>
</div>
</html>
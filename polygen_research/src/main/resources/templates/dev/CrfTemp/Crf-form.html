<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" th:replace="~{layout/main-layout :: ~{}}">

<div th:fragment="contenido">

    <form th:action="@{/crf/guardar}" th:object="${crfForm}" method="post">

        <div class="card" style="margin-top: 1.5rem;">
            <div class="card-header">
                <h3><i class="ph-bold ph-clipboard-text"></i> 2. Datos del Estudio (CRF)</h3>
            </div>
            <div class="card-body">

                <hr style="margin: 2rem 0;">
                <div th:each="dato, stat : *{datosCrfList}" class="form-group">

                    <label th:for="${'valor-' + stat.index}" th:text="${dato.campoCrf.nombre}"></label>
                    <small th:if="${dato.campoCrf.descripcion != null}" th:text="${dato.campoCrf.descripcion}" style="display: block; color: var(--color-texto-secundario); margin-bottom: 0.5rem;"></small>

                    <div th:switch="${dato.campoCrf.tipo}">

                        <input th:case="'NUMERO'" type="number" step="any" class="form-control" th:id="${'valor-' + stat.index}"
                            th:field="*{datosCrfList[__${stat.index}__].valor}">

                        <input th:case="'FECHA'" type="date" class="form-control" th:id="${'valor-' + stat.index}"
                            th:field="*{datosCrfList[__${stat.index}__].valor}">
                        
                        <div th:case="'SI/NO'" class="radio-group-sino">
                            <label class="radio-label">
                                <input type="radio"
                                       th:name="${'datosCrfList[' + stat.index + '].valor'}"
                                       value="1"
                                       th:checked="${#strings.equals(dato.valor, '1')}"
                                       class="radio-deselect" />
                                <span>SÃ­</span>
                            </label>
                            <label class="radio-label">
                                <input type="radio"
                                       th:name="${'datosCrfList[' + stat.index + '].valor'}"
                                       value="0"
                                       th:checked="${#strings.equals(dato.valor, '0')}"
                                       class="radio-deselect" />
                                <span>No</span>
                            </label>
                        </div>

                        <div th:case="'SELECCION_UNICA'" class="radio-group-sino">
                            <label th:each="opcion : ${dato.campoCrf.opciones}" class="radio-label">
                                <input type="radio"
                                       th:name="${'datosCrfList[' + stat.index + '].valor'}"
                                       th:value="${opcion.orden}"
                                       th:checked="${#strings.equals(dato.valor, #strings.toString(opcion.orden))}"
                                       class="radio-deselect" />
                                <span th:text="${opcion.etiqueta}"></span>
                            </label>
                        </div>
                        <input th:case="*" type="text" class="form-control" th:id="${'valor-' + stat.index}"
                            th:field="*{datosCrfList[__${stat.index}__].valor}">
                    </div>

                    <input type="hidden" th:field="*{datosCrfList[__${stat.index}__].campoCrf.idCampo}" />
                </div>
            </div>
        </div>

        <div style="margin-top: 1.5rem; display: flex; gap: 1rem;">
            <button type="submit" class="btn-primario">Guardar CRF Completo</button>
            <a th:href="@{/inicio}" class="btn-secundario">Cancelar</a>
        </div>

        <div th:if="${errorMessage}" class="alert alert-error" style="margin-top: 1.5rem;">
            <strong>Error:</strong> <span th:text="${errorMessage}"></span>
        </div>

    </form>
</div>

</html>